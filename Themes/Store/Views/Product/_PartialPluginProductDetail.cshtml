@model ProductDetailsModel
@using System.Globalization
@using Nop.Core
@using Nop.Core.Domain.Seo;
@using Nop.Core.Infrastructure;
@using Nop.Services.Directory
@using Nop.Web.Models.Catalog;


<!--product breadcrumb-->
@{
    Layout = "";
}
  
    <div class="pop-content" id="contactus_dialog">
        <div class="container pop-box">
            <span class="close" title="@T("common.close")">&nbsp;</span>
            <div class="main-product-infomation">
                @Html.Partial("_ProductBreadcrumb", Model.Breadcrumb)
                <div class="row">
                    <div class="col-md-4 product-picture">
                        @Html.Partial("_ProductDetailsPictures", Model)
                    </div>
                    @using (Html.BeginRouteForm("Product", new { SeName = Model.SeName }, FormMethod.Post, new { id = "product-details-form" }))
                    {
                        <div class="col-md-8 product-inner" id="capsuleSelect">
                            @*@Html.Partial("_Discontinued", Model)*@

                            <a href="@Url.RouteUrl("Product", new { SeName = Model.SeName })" title="@Model.DefaultPictureModel.Title" class="shopping-picture"><h1 class="shopping-product-heading">@Model.Name</h1></a>
                            <p class="shopping-product-text">@Html.Raw(Model.ShortDescription)</p>
                            <!--product reviews-->
                            @Html.Partial("_ProductReviewOverview", Model.ProductReviewOverview)

                            @if (!Model.AddToCart.CustomerEntersPrice)
                            {
                                <div class="shopping-product-price">
                                    <div class="price">
                                        @if (Model.ProductPrice.CallForPrice)
                                        {
                                            <div class="actual-price">
                                                @T("Products.CallForPrice")
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="actual-price">
                                                @if (Model.IsRental)
                                                {
                                                    @T("Products.Price.RentalPrice")<text>: </text>
                                                    <span class="revise-sum @("price-value-" + Model.Id)">@Model.ProductPrice.RentalPrice</span>
                                                    @Model.ProductPrice.CurrencyCode
                                                }
                                                else
                                                {
                                                    <span class="revise-sum @("price-value-" + Model.Id)">@Model.ProductPrice.Price</span>
                                                    @Model.ProductPrice.CurrencyCode
                                                }
                                                @if (String.IsNullOrWhiteSpace(Model.ProductPrice.OldPrice))
                                                {
                                                    <span class="old-price @("old-price-" + Model.Id)">@Model.ProductPrice.OldPrice</span>
                                                }
                                            </div>
                                        }

                                    </div>
                                    @if (Model.TierPrices.Count > 0 && !(Model.TierPrices.Count == 1 && Model.TierPrices[0].Quantity <= 1))
                                    {
                                        <div class="discount">

                                            @for (var i = 0; i < Model.TierPrices.Count; i++)
                                            {
                                                if (i == Model.TierPrices.Count - 1)
                                                {
                                                    <div>@T("products.tierprices.price.formater", Model.TierPrices[i].Quantity + "+", Model.TierPrices[i].Price)</div>
                                                }
                                                else
                                                {
                                                    var q = Model.TierPrices[i].Quantity == Model.TierPrices[i + 1].Quantity - 1 ? Model.TierPrices[i].Quantity + "" : Model.TierPrices[i].Quantity + " - " + (Model.TierPrices[i + 1].Quantity - 1);
                                                    <div>@T("products.tierprices.price.formater", q, Model.TierPrices[i].Price)</div>

                                                }
                                            }
                                        </div>
                                    }

                                </div>
                            }

                            @*  todo: 没有礼品卷, 没有租赁功能*@<!--attributes-->

                            @if (Model.ProductPrice.CallForPrice)
                            {
                                <div class="shopping-product-btn">
                                    <a class="btn-add-contact" href="@Url.RouteUrl("ContactUs")"><span class="iconfont icon-youxiang"></span> <span>@T("Products.CallForPrice")</span></a>
                                </div>
                            }
                            else
                            {
                                if (Model.ProductAttributes.Count == 0)
                                {
                                    <input type="hidden" class="no-attributes"
                                           data-id="@Model.Id"
                                           data-instock="@T("products.availability.instock")"
                                           data-url="@Url.Action("productdetails_attributechange", "shoppingcart", new {productId = Model.Id, validateAttributeConditions = false, loadPicture = false})" />
                                }
                                var dataDictAttributes = new ViewDataDictionary();
                                dataDictAttributes.TemplateInfo.HtmlFieldPrefix = string.Format("attributes_{0}", Model.Id);
                                @Html.Partial("_ProductAttributes", Model.ProductAttributes, dataDictAttributes)
                                //加入购物车
                                var dataDictAddToCart = new ViewDataDictionary();
                                dataDictAddToCart.TemplateInfo.HtmlFieldPrefix = string.Format("addtocart_{0}", Model.Id);
                                @Html.Partial("_AddToCart", Model.AddToCart, dataDictAddToCart)}

                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
